<html>
<head>
   <meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
   <title>Chapter 5. Advanced detection</title>
   <link href="book.css" rel="stylesheet" type="text/css">
   <meta content="DocBook XSL Stylesheets V1.69.1" name="generator">
   <link href="index.html" rel="start" title="PHP_CompatInfo Manual">
   <link href="pt02.html" rel="up" title="Part II. Getting Started">
   <link href="ch04s02.html" rel="prev" title="Detection of files into a directory">
   <link href="ch05s02.html" rel="next" title="Detection of files into a directory">
</head>
<body alink="#0000FF" bgcolor="white" link="#0000FF" text="black" vlink="#840084">
<table class="pciHeader">
   <tr>
      <td><img align="left" alt="PEAR logo" src="img/pearsmall.gif">
         <h1>PHP_CompatInfo : The Definitive Guide</h1>

         <p>
         <div class="navheader">
            <table summary="Navigation header" width="100%">
               <tr>
                  <th align="center" colspan="3">Chapter 5. Advanced detection</th>
               </tr>
               <tr>
                  <td align="left" width="20%"><a accesskey="p" href="ch04s02.html">Prev</a> </td>
                  <th align="center" width="60%">Part II. Getting Started</th><td align="right" width="20%"> <a accesskey="n" href="ch05s02.html">Next</a></td>
               </tr>
            </table>
         </div></p>
      </td>
   </tr>
</table>
<div class="chapter" lang="en"><div class="titlepage"><div><div>
            <h2 class="title"><a name="developers.advanced"></a>Chapter 5. Advanced detection</h2></div>
      </div>
   </div>
   <div class="toc">

      <p><b>Table of Contents</b></p>
      <dl><dt><span class="sect1"><a href="ch05.html#developers.advanced.file">Detection of a single file</a></span></dt>
         <dd>
         <dl><dt><span class="sect2"><a href="ch05.html#id4727776">Usage with SAPI</a></span></dt><dt><span class="sect2"><a href="ch05.html#id4777019">Usage with CLI</a></span></dt>
         </dl></dd><dt><span class="sect1"><a href="ch05s02.html">Detection of files into a directory</a></span></dt>
         <dd>
         <dl><dt><span class="sect2"><a href="ch05s02.html#id4777093">Usage with SAPI</a></span></dt><dt><span class="sect2"><a href="ch05s02.html#id4777350">Usage with CLI</a></span></dt>
         </dl></dd>
      </dl>
   </div>
   <div class="sect1" lang="en"><div class="titlepage"><div><div>
               <h2 class="title" style="clear: both">
               <a name="developers.advanced.file"></a>Detection of a single file</h2></div>
         </div>
      </div>
      <div class="toc">
         <dl><dt><span class="sect2"><a href="ch05.html#id4727776">Usage with SAPI</a></span></dt><dt><span class="sect2"><a href="ch05.html#id4777019">Usage with CLI</a></span></dt>
         </dl>
      </div>

      <p>If your file implement code condition that is optional and don't break main goal, such as, for example : if 
      <code class="methodname">function_exists</code> then i do something, else i do something else. </p>

      <p>Solution is very easy: You have to specify what function required should be considered as optional. </p>
      <div class="sect2" lang="en"><div class="titlepage"><div><div>
                  <h3 class="title"><a name="id4727776"></a>Usage with SAPI</h3></div>
            </div>
         </div>

         <p>Suppose we have to detect which PHP version we need to run this chunk of script named "errorHandler.php". With standard behavior, PHP_CompatInfo returns PHP 4.3.0 (because 
         <code class="methodname">debug_backtrace</code> came with version 4.3.0). So, if we ignore function 
         <code class="methodname">debug_backtrace</code> to find out the minimum version, we will get the real and true result. </p>

         <p></p>
<pre class="programlisting">
      
&lt;?php
// ...
if (function_exists('debug_backtrace')) {
    $backtrace = debug_backtrace();
} else {
    $backtrace = false;
}
// ...
?&gt;
      
     </pre>

         <p></p>

         <p>We will use another very simple detection script. Have a look on options array given as second parameter (here is the magic). </p>
<pre class="programlisting">
      
&lt;?php
require_once 'PHP/CompatInfo.php';

$info = new PHP_CompatInfo();
$path_to_file = dirname(__FILE__) . DIRECTORY_SEPARATOR . 'errorHandler.php';
$options = array('ignore_functions' =&gt; array('debug_backtrace'));
$res = $info-&gt;parseFile($path_to_file, $options);

echo '&lt;pre&gt;'; var_dump($res); echo '&lt;/pre&gt;';
?&gt;
      
     </pre>

         <p></p>

         <p>And the raw results are : </p>
<pre class="screen">
array(4) {
  ["max_version"]=&gt;
  string(0) ""
  ["version"]=&gt;
  string(5) "3.0.7"
  ["extensions"]=&gt;
  array(0) {
  }
  ["constants"]=&gt;
  array(0) {
  }
}
     </pre>

         <p></p>
      </div>
      <div class="sect2" lang="en"><div class="titlepage"><div><div>
                  <h3 class="title"><a name="id4777019"></a>Usage with CLI</h3></div>
            </div>
         </div>

         <p>pcicmd command used files to specify list of values on 
         <em class="parameter"><code>--ignore-</code></em> switchs. </p>
<pre class="synopsis">
pcicmd -f \wamp\www\pci\errorHandler.php -in \wamp\www\pci\functions.txt
     </pre>

         <p></p>
         <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Note">
               <tr>
                  <td align="center" rowspan="2" valign="top" width="48px"><img alt="[Note]" src="img/admons/note.png"></td>
                  <th align="left">Note</th>
               </tr>
               <tr>
                  <td align="left" valign="top"> functions.txt is a simple text file with one line by PHP function that should be ignore. In our example, content is one line with value : 

                     <p>debug_backtrace </p>
                  </td>
               </tr>
            </table>
         </div>

         <p></p>

         <p>And result give: </p>
<pre class="screen">
+------------------------+---------+------------+------------------+
| File                   | Version | Extensions | Constants/Tokens |
+------------------------+---------+------------+------------------+
| [...]\errorHandler.php | 3.0.7   |            |                  |
+------------------------+---------+------------+------------------+
     </pre>

         <p></p>
      </div>
   </div>
</div>
<table class="pciFooter">
   <tr>
      <td align="left">PHP_CompatInfo : The Definitive Guide</td>
      <td align="right">v 1.4.0 : September 27, 2006</td>
   </tr>
</table>
<div class="navfooter"><hr>
   <table summary="Navigation footer" width="100%">
      <tr>
         <td align="left" width="40%"><a accesskey="p" href="ch04s02.html">Prev</a> </td>
         <td align="center" width="20%"><a accesskey="u" href="pt02.html">Up</a></td>
         <td align="right" width="40%"> <a accesskey="n" href="ch05s02.html">Next</a></td>
      </tr>
      <tr>
         <td align="left" valign="top" width="40%">Detection of files into a directory </td>
         <td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td>
         <td align="right" valign="top" width="40%"> Detection of files into a directory</td>
      </tr>
   </table>
</div>
</body>
</html> 
